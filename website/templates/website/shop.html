{% extends 'website/base.html' %}
{% load static %}
{% load cloudinary %}

{% block title %}Premium Shop - Fieldmax{% endblock %}

{% block content %}
<style>
  :root {
    --primary: #0dcaf0;
    --primary-dark: #0ab4d6;
    --primary-light: #5fe1ff;
    --success: #10b981;
    --warning: #f59e0b;
    --danger: #ef4444;
    --info: #3b82f6;
    --purple: #8b5cf6;
    --pink: #ec4899;
    --gray-50: #f9fafb;
    --gray-100: #f3f4f6;
    --gray-200: #e5e7eb;
    --gray-300: #d1d5db;
    --gray-600: #4b5563;
    --gray-700: #374151;
    --gray-900: #111827;
    --transition-smooth: cubic-bezier(0.4, 0, 0.2, 1);
  }

  /* HERO SECTION WITH PARTICLES EFFECT */
  .shop-hero {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 50%, #f093fb 100%);
    padding: 5rem 0 4rem;
    position: relative;
    overflow: hidden;
  }

  .shop-hero::before {
    content: '';
    position: absolute;
    inset: 0;
    background: 
      radial-gradient(circle at 20% 50%, rgba(255,255,255,0.1) 0%, transparent 50%),
      radial-gradient(circle at 80% 80%, rgba(255,255,255,0.1) 0%, transparent 50%);
    animation: pulse 4s ease-in-out infinite;
  }

  @keyframes pulse {
    0%, 100% { opacity: 0.5; }
    50% { opacity: 1; }
  }

  .shop-hero::after {
    content: '';
    position: absolute;
    inset: 0;
    background: url("data:image/svg+xml,%3Csvg width='60' height='60' viewBox='0 0 60 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='none' fill-rule='evenodd'%3E%3Cg fill='%23ffffff' fill-opacity='0.03'%3E%3Cpath d='M36 34v-4h-2v4h-4v2h4v4h2v-4h4v-2h-4zm0-30V0h-2v4h-4v2h4v4h2V6h4V4h-4zM6 34v-4H4v4H0v2h4v4h2v-4h4v-2H6zM6 4V0H4v4H0v2h4v4h2V6h4V4H6z'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E");
    animation: moveBackground 20s linear infinite;
  }

  @keyframes moveBackground {
    0% { transform: translate(0, 0); }
    100% { transform: translate(60px, 60px); }
  }

  .shop-hero-content {
    position: relative;
    z-index: 1;
  }

  .shop-hero h1 {
    color: #ffffff;
    font-weight: 900;
    font-size: 3.5rem;
    margin-bottom: 1rem;
    text-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
    letter-spacing: -1px;
    background: linear-gradient(to right, #ffffff, #f0f0f0);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
    animation: shimmer 3s ease-in-out infinite;
  }

  @keyframes shimmer {
    0%, 100% { opacity: 1; }
    50% { opacity: 0.9; }
  }

  .shop-hero p {
    color: rgba(255, 255, 255, 0.95);
    font-size: 1.3rem;
    font-weight: 500;
    text-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
  }

  .shop-stats {
    display: flex;
    gap: 2rem;
    justify-content: center;
    margin-top: 2.5rem;
    flex-wrap: wrap;
  }

  .stat-item {
    display: flex;
    align-items: center;
    gap: 1rem;
    padding: 1rem 2rem;
    background: rgba(255, 255, 255, 0.15);
    backdrop-filter: blur(20px);
    border-radius: 2rem;
    border: 1px solid rgba(255, 255, 255, 0.3);
    transition: all 0.3s var(--transition-smooth);
    cursor: pointer;
  }

  .stat-item:hover {
    transform: translateY(-5px) scale(1.05);
    background: rgba(255, 255, 255, 0.25);
    box-shadow: 0 8px 32px rgba(0, 0, 0, 0.2);
  }

  .stat-icon {
    width: 50px;
    height: 50px;
    background: linear-gradient(135deg, rgba(255, 255, 255, 0.3), rgba(255, 255, 255, 0.1));
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 1.5rem;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
  }

  .stat-content h3 {
    font-size: 2rem;
    font-weight: 800;
    margin: 0;
    color: #ffffff;
    text-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
  }

  .stat-content p {
    font-size: 0.9rem;
    margin: 0;
    color: rgba(255, 255, 255, 0.9);
  }

  /* Controls Section */
  .controls-section {
    background: #ffffff;
    padding: 2rem;
    border-radius: 1.5rem;
    margin: -3rem auto 3rem;
    max-width: 1400px;
    box-shadow: 0 20px 60px rgba(0, 0, 0, 0.15);
    position: relative;
    z-index: 10;
    border: 1px solid rgba(0, 0, 0, 0.05);
  }

  .search-bar-container {
    display: flex;
    gap: 1rem;
    margin-bottom: 1.5rem;
    flex-wrap: wrap;
  }

  .search-input-wrapper {
    flex: 1;
    min-width: 300px;
    position: relative;
  }

  .search-input {
    width: 100%;
    padding: 1rem 1.25rem 1rem 3.5rem;
    border: 2px solid var(--gray-200);
    border-radius: 1rem;
    font-size: 1rem;
    transition: all 0.3s ease;
    background: var(--gray-50);
  }

  .search-input:focus {
    outline: none;
    border-color: var(--primary);
    background: #ffffff;
    box-shadow: 0 0 0 4px rgba(13, 202, 240, 0.15), 0 8px 16px rgba(0, 0, 0, 0.1);
    transform: translateY(-2px);
  }

  .search-icon {
    position: absolute;
    left: 1.25rem;
    top: 50%;
    transform: translateY(-50%);
    color: var(--gray-600);
    font-size: 1.25rem;
    transition: all 0.3s ease;
  }

  .search-input:focus + .search-icon {
    color: var(--primary);
    transform: translateY(-50%) scale(1.1);
  }

  .clear-search {
    position: absolute;
    right: 1rem;
    top: 50%;
    transform: translateY(-50%);
    background: var(--gray-200);
    color: var(--gray-600);
    border: none;
    width: 28px;
    height: 28px;
    border-radius: 50%;
    cursor: pointer;
    display: none;
    align-items: center;
    justify-content: center;
    transition: all 0.3s ease;
  }

  .clear-search:hover {
    background: var(--danger);
    color: #ffffff;
    transform: translateY(-50%) rotate(90deg);
  }

  .clear-search.active {
    display: flex;
  }

  .view-toggle {
    display: flex;
    gap: 0.5rem;
    background: var(--gray-100);
    padding: 0.35rem;
    border-radius: 1rem;
  }

  .view-btn {
    padding: 0.75rem 1.25rem;
    border: none;
    background: transparent;
    color: var(--gray-600);
    border-radius: 0.75rem;
    cursor: pointer;
    transition: all 0.3s var(--transition-smooth);
    font-weight: 600;
    display: flex;
    align-items: center;
    gap: 0.5rem;
    font-size: 0.95rem;
  }

  .view-btn:hover {
    background: rgba(13, 202, 240, 0.1);
    color: var(--primary);
  }

  .view-btn.active {
    background: linear-gradient(135deg, var(--primary), var(--primary-dark));
    color: #ffffff;
    box-shadow: 0 4px 12px rgba(13, 202, 240, 0.3);
    transform: scale(1.05);
  }

  /* Filters Row */
  .filters-row {
    display: flex;
    gap: 1.5rem;
    flex-wrap: wrap;
    align-items: center;
  }

  .filter-group {
    display: flex;
    gap: 0.75rem;
    flex-wrap: wrap;
    align-items: center;
  }

  .filter-label {
    font-weight: 700;
    color: var(--gray-700);
    display: flex;
    align-items: center;
    margin-right: 0.5rem;
    white-space: nowrap;
    font-size: 0.95rem;
  }

  .filter-chip {
    padding: 0.625rem 1.25rem;
    border: 2px solid var(--gray-200);
    background: #ffffff;
    color: var(--gray-700);
    border-radius: 2rem;
    font-weight: 600;
    font-size: 0.875rem;
    cursor: pointer;
    transition: all 0.3s var(--transition-smooth);
    white-space: nowrap;
    position: relative;
    overflow: hidden;
  }

  .filter-chip::before {
    content: '';
    position: absolute;
    top: 0;
    left: -100%;
    width: 100%;
    height: 100%;
    background: linear-gradient(90deg, transparent, rgba(255,255,255,0.4), transparent);
    transition: left 0.5s ease;
  }

  .filter-chip:hover::before {
    left: 100%;
  }

  .filter-chip:hover {
    border-color: var(--primary);
    color: var(--primary);
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(13, 202, 240, 0.2);
  }

  .filter-chip.active {
    background: linear-gradient(135deg, var(--primary), var(--primary-dark));
    border-color: var(--primary);
    color: #ffffff;
    box-shadow: 0 4px 12px rgba(13, 202, 240, 0.3);
  }

  /* Sorting Select */
  .sort-select {
    padding: 0.75rem 1.25rem;
    border: 2px solid var(--gray-200);
    border-radius: 1rem;
    font-size: 0.9rem;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s ease;
    background: #fff;
    color: var(--gray-700);
  }

  .sort-select:focus {
    outline: none;
    border-color: var(--primary);
    box-shadow: 0 0 0 3px rgba(13, 202, 240, 0.1);
  }

  /* CATEGORY HEADER */
  .category-section {
    margin-bottom: 4rem;
  }

  @keyframes fadeInUp {
    from {
      opacity: 0;
      transform: translateY(30px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }

  .category-header {
    background: linear-gradient(135deg, #ffffff 0%, var(--gray-50) 100%);
    padding: 2.5rem;
    border-radius: 1.5rem;
    margin-bottom: 2rem;
    border-left: 6px solid;
    border-image: linear-gradient(to bottom, var(--primary), var(--purple)) 1;
    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
    position: relative;
    overflow: hidden;
    animation: fadeInUp 0.6s ease-out;
  }

  .category-header::before {
    content: '';
    position: absolute;
    top: -50%;
    right: -10%;
    width: 300px;
    height: 300px;
    background: radial-gradient(circle, rgba(13, 202, 240, 0.1) 0%, transparent 70%);
    border-radius: 50%;
  }

  .category-title-row {
    display: flex;
    justify-content: space-between;
    align-items: center;
    flex-wrap: wrap;
    gap: 1.5rem;
  }

  .category-title {
    font-size: 2.25rem;
    font-weight: 900;
    color: var(--gray-900);
    margin: 0;
    display: flex;
    align-items: center;
    gap: 1.25rem;
  }

  .category-icon {
    width: 60px;
    height: 60px;
    background: linear-gradient(135deg, var(--primary), var(--purple));
    border-radius: 1rem;
    display: flex;
    align-items: center;
    justify-content: center;
    color: #fff;
    font-size: 1.75rem;
    box-shadow: 0 8px 20px rgba(13, 202, 240, 0.3);
    animation: float 3s ease-in-out infinite;
  }

  @keyframes float {
    0%, 100% { transform: translateY(0); }
    50% { transform: translateY(-10px); }
  }

  .category-badge {
    display: inline-flex;
    align-items: center;
    gap: 0.625rem;
    padding: 0.75rem 1.5rem;
    background: linear-gradient(135deg, var(--primary), var(--primary-dark));
    color: #fff;
    border-radius: 2rem;
    font-size: 0.95rem;
    font-weight: 700;
    box-shadow: 0 4px 16px rgba(13, 202, 240, 0.3);
    transition: all 0.3s ease;
  }

  .category-badge:hover {
    transform: scale(1.05);
    box-shadow: 0 6px 20px rgba(13, 202, 240, 0.4);
  }

  .category-meta {
    display: flex;
    gap: 2.5rem;
    margin-top: 1.5rem;
    flex-wrap: wrap;
  }

  .meta-item {
    display: flex;
    align-items: center;
    gap: 0.75rem;
    color: var(--gray-600);
    font-size: 1rem;
    font-weight: 500;
  }

  .meta-item i {
    color: var(--primary);
    font-size: 1.25rem;
  }

  /* PRODUCT GRID & CARD STYLES */
  .products-grid {
    display: grid;
    gap: 2rem;
  }
  .products-grid.grid-view {
    grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
  }
  .products-grid.list-view {
    grid-template-columns: 1fr;
  }

  .product-card {
    background: #fff;
    border-radius: 1.5rem;
    overflow: hidden;
    box-shadow: 0 4px 16px rgba(0,0,0,0.1);
    transition: all 0.4s ease;
    display: flex;
    flex-direction: row;
    border: 1px solid rgba(0,0,0,0.05);
  }
  /* Grid layout - column */
  .products-grid.grid-view .product-card {
    flex-direction: column;
  }
  /* List layout - row */
  .products-grid.list-view .product-card {
    flex-direction: row;
  }

  /* Hover effect on product card */
  .product-card:hover {
    transform: translateY(-8px) scale(1.02);
    box-shadow: 0 20px 40px rgba(0,0,0,0.2);
    border-color: var(--primary);
  }

  /* Image wrapper styles */
  .product-image-wrapper {
    position: relative;
    background: linear-gradient(135deg, var(--gray-100), var(--gray-50));
    overflow: hidden;
  }
  /* Grid view: full width, aspect ratio */
  .products-grid.grid-view .product-image-wrapper {
    width: 100%;
    padding-top: 75%; /* 4:3 aspect ratio */
  }
  /* List view: fixed width, min height */
  .products-grid.list-view .product-image-wrapper {
    width: 280px;
    min-height: 220px;
    flex-shrink: 0;
  }

  /* Product image styles with hover zoom */
  .product-image {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    object-fit: cover;
    transition: transform 0.6s ease, filter 0.3s ease;
    filter: brightness(0.95);
  }

  .product-card:hover .product-image {
    transform: scale(1.15) rotate(2deg);
    filter: brightness(1);
  }

  /* Overlay effect on hover */
  .image-overlay {
    position: absolute;
    inset: 0;
    background: linear-gradient(to bottom, transparent, rgba(0,0,0,0.4));
    opacity: 0;
    transition: opacity 0.3s ease;
  }
  .product-card:hover .image-overlay {
    opacity: 1;
  }

  /* No image placeholder styling */
  .no-image-placeholder {
    position: absolute;
    inset: 0;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    background: linear-gradient(135deg, #667eea, #764ba2);
    color: rgba(255,255,255,0.9);
  }
  .no-image-placeholder i {
    font-size: 4.5rem;
    margin-bottom: 0.75rem;
    opacity: 0.5;
  }
  .no-image-placeholder span {
    font-size: 0.95rem;
    color: rgba(255,255,255,0.8);
    font-weight: 600;
  }

  /* Badges on product */
  .product-badges {
    position: absolute;
    top: 1rem;
    left: 1rem;
    right: 1rem;
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
    z-index: 2;
  }
  .badge-group {
    display: flex;
    flex-direction: column;
    gap: 0.625rem;
  }
  .product-badge {
    padding: 0.5rem 1rem;
    border-radius: 2rem;
    font-size: 0.75rem;
    font-weight: 800;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    position: relative;
    overflow: hidden;
  }

  /* Button hover animation for badges */
  .btn-primary::before {
    content: '';
    position: absolute;
    top: 50%;
    left: 50%;
    width: 0;
    height: 0;
    background: rgba(255,255,255,0.3);
    border-radius: 50%;
    transform: translate(-50%, -50%);
    transition: width 0.6s, height 0.6s;
  }
  .btn-primary:hover::before {
    width: 300px;
    height: 300px;
  }
  .btn-primary:hover:not(:disabled) {
    transform: translateY(-3px) scale(1.03);
    box-shadow: 0 12px 28px rgba(13, 202, 240, 0.4);
  }
  .btn-primary:active:not(:disabled) {
    transform: translateY(0) scale(0.98);
  }
  .btn-primary:disabled {
    background: linear-gradient(135deg, var(--gray-200), var(--gray-300));
    color: var(--gray-600);
    cursor: not-allowed;
  }

  /* Icon buttons */
  .btn-icon {
    width: 3rem;
    height: 3rem;
    background: var(--gray-100);
    color: var(--gray-700);
    border: 2px solid var(--gray-200);
    border-radius: 1rem;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    transition: all 0.3s var(--transition-smooth);
    font-size: 1.25rem;
  }
  .btn-icon:hover {
    background: linear-gradient(135deg, var(--primary), var(--primary-dark));
    color: #fff;
    border-color: var(--primary);
    transform: translateY(-3px) rotate(5deg);
    box-shadow: 0 8px 16px rgba(13, 202, 240, 0.3);
  }

  /* Quick view modal & animations */
  .quick-view-modal {
    display: none;
    position: fixed;
    inset: 0;
    background: rgba(0,0,0,0.8);
    backdrop-filter: blur(10px);
    z-index: 10000;
    align-items: center;
    justify-content: center;
    padding: 2rem;
    animation: fadeIn 0.3s ease;
  }
  .quick-view-modal.active {
    display: flex;
  }
  @keyframes fadeIn {
    from { opacity: 0; }
    to { opacity: 1; }
  }
  .modal-content {
    background: #fff;
    border-radius: 2rem;
    max-width: 900px;
    width: 100%;
    max-height: 90vh;
    overflow-y: auto;
    animation: slideUp 0.4s ease;
    box-shadow: 0 30px 60px rgba(0,0,0,0.3);
  }
  @keyframes slideUp {
    from {
      opacity: 0;
      transform: translateY(50px) scale(0.9);
    }
    to {
      opacity: 1;
      transform: translateY(0) scale(1);
    }
  }

  /* Empty state styles */
  .empty-state {
    text-align: center;
    padding: 5rem 2rem;
    background: linear-gradient(135deg, var(--gray-50), #fff);
    border-radius: 1.5rem;
    margin: 2rem 0;
    border: 2px dashed var(--gray-300);
  }
  .empty-icon {
    width: 140px;
    height: 140px;
    margin: 0 auto 2rem;
    background: linear-gradient(135deg, var(--gray-200), var(--gray-100));
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 5rem;
    color: var(--gray-400);
    animation: float 3s ease-in-out infinite;
  }
  .empty-state h3 {
    font-size: 2rem;
    font-weight: 800;
    color: var(--gray-900);
    margin-bottom: 1rem;
  }
  .empty-state p {
    font-size: 1.15rem;
    color: var(--gray-600);
    max-width: 500px;
    margin: 0 auto 2rem;
  }

  /* Skeleton loader */
  .loading-skeleton {
    background: linear-gradient(90deg, var(--gray-100) 25%, var(--gray-50) 50%, var(--gray-100) 75%);
    background-size: 200% 100%;
    animation: loading 1.5s ease-in-out infinite;
    border-radius: 0.5rem;
  }
  @keyframes loading {
    0% { background-position: 200% 0; }
    100% { background-position: -200% 0; }
  }

  /* Responsive styles */
  @media(max-width: 992px) {
    .shop-hero h1 { font-size: 2.75rem; }
    .category-title { font-size: 2rem; }
    .products-grid.grid-view { grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); }
    .stat-item { padding: 0.875rem 1.5rem; }
  }
  @media(max-width: 768px) {
    .shop-hero { padding: 4rem 0 3rem; }
    .shop-hero h1 { font-size: 2.25rem; }
    .controls-section { margin: -2rem auto 2rem; padding: 1.5rem; }
    .products-grid.list-view .product-card { flex-direction: column; }
    .product-image-wrapper { width: 100%; padding-top: 75%; min-height: auto; }
    .view-toggle { width: 100%; }
    .view-btn { flex: 1; justify-content: center; }
    .category-title { font-size: 1.75rem; }
    .category-icon { width: 50px; height: 50px; font-size: 1.5rem; }
  }
  @media(max-width: 576px) {
    .shop-hero h1 { font-size: 1.85rem; }
    .shop-stats { gap: 1rem; }
    .stat-icon { width: 42px; height: 42px; font-size: 1.25rem; }
    .stat-content h3 { font-size: 1.5rem; }
    .products-grid.grid-view { grid-template-columns: 1fr; }
    .category-title { font-size: 1.5rem; }
    .filters-row { flex-direction: column; align-items: stretch; }
    .filter-group { width: 100%; }
    .filter-chip { flex: 1; text-align: center; }
    .search-input-wrapper { min-width: 100%; }
    .product-price { font-size: 1.85rem; }
  }

  /* Scroll to top button styles */
  .scroll-to-top {
    position: fixed;
    bottom: 2rem;
    right: 2rem;
    width: 56px;
    height: 56px;
    background: linear-gradient(135deg, var(--primary), var(--purple));
    color: #fff;
    border: none;
    border-radius: 50%;
    display: none;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    font-size: 1.5rem;
    box-shadow: 0 8px 20px rgba(13, 202, 240, 0.4);
    transition: all 0.3s ease;
    z-index: 1000;
  }
  .scroll-to-top.visible {
    display: flex;
    animation: bounceIn 0.6s ease;
  }
  @keyframes bounceIn {
    0% {
      opacity: 0;
      transform: scale(0.3) translateY(50px);
    }
    50% {
      opacity: 1;
      transform: scale(1.1);
    }
    70% { transform: scale(0.9); }
    100% { transform: scale(1); }
  }
  .scroll-to-top:hover {
    transform: translateY(-5px) scale(1.1);
    box-shadow: 0 12px 28px rgba(13, 202, 240, 0.5);
  }
  .scroll-to-top:active {
    transform: translateY(-2px) scale(1.05);
  }

  /* Notification Toast */
  .notification-toast {
    position: fixed;
    top: 2rem;
    right: 2rem;
    min-width: 300px;
    max-width: 400px;
    background: #fff;
    border-radius: 1rem;
    padding: 1.25rem 1.5rem;
    box-shadow: 0 12px 32px rgba(0,0,0,0.2);
    display: flex;
    align-items: center;
    gap: 1rem;
    z-index: 10001;
    animation: slideInRight 0.4s ease;
  }
  @keyframes slideInRight {
    from {
      opacity: 0;
      transform: translateX(100px);
    }
    to {
      opacity: 1;
      transform: translateX(0);
    }
  }
  .notification-toast.success { border-left: 4px solid var(--success); }
  .notification-toast.warning { border-left: 4px solid var(--warning); }
  .notification-toast.error { border-left: 4px solid var(--danger); }
  .notification-toast.info { border-left: 4px solid var(--info); }
  .toast-icon {
    width: 40px;
    height: 40px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 1.25rem;
    flex-shrink: 0;
  }
  .toast-icon.success { background: rgba(16, 185, 129, 0.1); color: var(--success); }
  .toast-icon.warning { background: rgba(245, 158, 11, 0.1); color: var(--warning); }
  .toast-icon.error { background: rgba(239, 68, 68, 0.1); color: var(--danger); }
  .toast-icon.info { background: rgba(59, 130, 246, 0.1); color: var(--info); }
  .toast-content { flex: 1; }
  .toast-title {
    font-weight: 700;
    color: var(--gray-900);
    margin-bottom: 0.25rem;
  }
  .toast-message {
    font-size: 0.9rem;
    color: var(--gray-600);
  }
</style>

<!-- Hero Section -->
<section class="shop-hero">
  <!-- ... your hero HTML ... -->
  <div class="container-fluid px-4 shop-hero-content">
    <h1 class="text-center">Premium Shop Collection</h1>
    <p class="text-center">Discover quality products at unbeatable prices</p>
    <div class="shop-stats">
      <div class="stat-item">
        <div class="stat-icon"><i class="bi bi-box-seam"></i></div>
        <div class="stat-content">
          <h3 id="totalProducts">0</h3>
          <p>Products</p>
        </div>
      </div>
      <div class="stat-item">
        <div class="stat-icon"><i class="bi bi-check-circle"></i></div>
        <div class="stat-content">
          <h3 id="availableProducts">0</h3>
          <p>Available</p>
        </div>
      </div>
      <div class="stat-item">
        <div class="stat-icon"><i class="bi bi-grid-3x3"></i></div>
        <div class="stat-content">
          <h3 id="totalCategories">0</h3>
          <p>Categories</p>
        </div>
      </div>
    </div>
  </div>
</section>

<!-- Controls -->
<div class="container-fluid px-4">
  <div class="controls-section">
    <!-- Search & View toggle -->
    <div class="search-bar-container">
      <div class="search-input-wrapper">
        <input type="text" id="searchInput" class="search-input" placeholder="Search products by name, code, or SKU..."/>
        <i class="bi bi-search search-icon"></i>
        <button class="clear-search" id="clearSearch" aria-label="Clear search">
          <i class="bi bi-x"></i>
        </button>
      </div>
      <div class="view-toggle">
        <button class="view-btn active" data-view="grid"><i class="bi bi-grid-3x3-gap"></i>Grid</button>
        <button class="view-btn" data-view="list"><i class="bi bi-list-ul"></i>List</button>
      </div>
    </div>
    <!-- Filters -->
    <div class="filters-row">
      <!-- ... your filters ... -->
      <div class="filter-group">
        <span class="filter-label"><i class="bi bi-funnel"></i> Status:</span>
        <button class="filter-chip active" data-filter="status" data-value="all">All</button>
        <button class="filter-chip" data-filter="status" data-value="available">Available</button>
        <button class="filter-chip" data-filter="status" data-value="lowstock">Low Stock</button>
        <button class="filter-chip" data-filter="status" data-value="outofstock">Out of Stock</button>
      </div>
      <div class="filter-group">
        <span class="filter-label"><i class="bi bi-tag"></i> Type:</span>
        <button class="filter-chip active" data-filter="type" data-value="all">All</button>
        <button class="filter-chip" data-filter="type" data-value="single">Single Items</button>
        <button class="filter-chip" data-filter="type" data-value="bulk">Bulk Items</button>
      </div>
      <select class="sort-select" id="sortSelect">
        <option value="newest">‚≠ê Newest First</option>
        <option value="oldest">üìÖ Oldest First</option>
        <option value="price-low">üí∞ Price: Low to High</option>
        <option value="price-high">üíé Price: High to Low</option>
        <option value="name-az">üî§ Name: A to Z</option>
        <option value="name-za">üî§ Name: Z to A</option>
      </select>
    </div>
  </div>
</div>

<!-- Categories & Products -->
<div class="container-fluid px-4 mb-5">
  {% if categories %}
    {% for category in categories %}
      <div class="category-section" data-category="{{ category.name }}">
        <!-- Category Header -->
        <div class="category-header">
          <div class="category-title-row">
            <div class="category-title">
              <div class="category-icon">
                <i class="bi bi-{% if category.is_single_item %}phone{% else %}box-seam{% endif %}"></i>
              </div>
              <span>{{ category.name }}</span>
            </div>
            <div class="category-badge">
              <i class="bi bi-box-seam"></i>
              <span>{{ category.filtered_products.count }} {{ category.get_item_type_display }}</span>
            </div>
          </div>
          <div class="category-meta">
            <div class="meta-item"><i class="bi bi-tag"></i> <span>Identifier: <strong>{{ category.get_sku_type_display }}</strong></span></div>
            <div class="meta-item"><i class="bi bi-diagram-3"></i> <span>Code: <strong>{{ category.category_code }}</strong></span></div>
          </div>
        </div>
        {% if category.filtered_products.exists %}
          <div class="products-grid grid-view">
            {% for product in category.filtered_products %}
              <!-- Product Card -->
              <div class="product-card" data-status="{{ product.status }}"
                   data-type="{% if category.is_single_item %}single{% else %}bulk{% endif %}"
                   data-product-id="{{ product.id }}"
                   data-name="{{ product.name|lower }}"
                   data-code="{{ product.product_code|lower }}"
                   data-price="{{ product.selling_price }}">
                <!-- Product Image -->
                <div class="product-image-wrapper">
                  {% if product.image %}
                    <img src="{% cloudinary_url product.image width=600 height=450 crop='fill' quality='auto' fetch_format='auto' %}"
                         alt="{{ product.name }}" class="product-image" loading="lazy"
                         onerror="this.parentElement.innerHTML='<div class=\'no-image-placeholder\'><i class=\'bi bi-image\'></i><span>Image Failed to Load</span></div>'"/>
                    <div class="image-overlay"></div>
                  {% else %}
                    <div class="no-image-placeholder">
                      <i class="bi bi-image"></i>
                      <span>No Image Available</span>
                    </div>
                  {% endif %}
                  <!-- Badges -->
                  <div class="product-badges">
                    <div class="badge-group">
                      <span class="product-badge status-badge status-{{ product.status }}">{{ product.get_status_display }}</span>
                      <span class="product-badge item-type-badge">
                        <i class="bi bi-{% if category.is_single_item %}1-circle{% else %}stack{% endif %}"></i>
                        {{ category.get_item_type_display }}
                      </span>
                    </div>
                    <button class="wishlist-btn" onclick="toggleWishlist(this, '{{ product.id }}')" aria-label="Add to wishlist">
                      <i class="bi bi-heart"></i>
                    </button>
                  </div>
                </div>
                <!-- Product Info -->
                <div class="product-info">
                  <div class="product-header">
                    <div class="product-code">
                      <i class="bi bi-upc"></i> {{ product.product_code }}
                    </div>
                    <h3 class="product-name">{{ product.name }}</h3>
                    <!-- Rating -->
                    <div class="product-rating">
                      <div class="stars">
                        <i class="bi bi-star-fill"></i>
                        <i class="bi bi-star-fill"></i>
                        <i class="bi bi-star-fill"></i>
                        <i class="bi bi-star-fill"></i>
                        <i class="bi bi-star-half"></i>
                      </div>
                      <span class="rating-count">(4.5)</span>
                    </div>
                  </div>
                  <!-- Product Footer -->
                  <div class="product-footer">
                    <!-- Price -->
                    <div class="price-section">
                      <div class="price-row">
                        <div>
                          <div class="price-label">Selling Price</div>
                          <div class="product-price">KSh {{ product.selling_price|floatformat:2 }}</div>
                        </div>
                      </div>
                    </div>
                    {% if category.is_bulk_item and product.quantity > 0 %}
                      <div class="stock-indicator">
                        <div class="stock-text">
                          <strong>{{ product.quantity }} units</strong>
                          <span>Available in stock</span>
                        </div>
                      </div>
                    {% endif %}
                    <!-- Action Buttons for Guest -->
                    {% if not user.is_authenticated %}
                      <div class="action-buttons">
                        {% if product.status == 'available' or product.status == 'lowstock' %}
                          <button class="btn-primary"
                                  data-product-id="{{ product.id }}"
                                  data-product-name="{{ product.name }}"
                                  data-product-price="{{ product.selling_price }}"
                                  data-product-code="{{ product.product_code }}"
                                  data-product-image="{% if product.image %}{% cloudinary_url product.image width=400 height=300 crop='fill' quality='auto' %}{% endif %}"
                                  data-max-quantity="{{ product.quantity }}"
                                  onclick="addToCart(this)">
                            <i class="bi bi-cart-plus"></i> Add to Cart
                          </button>
                        {% elif product.status == 'outofstock' %}
                          <button class="btn-primary" disabled><i class="bi bi-inbox"></i> Out of Stock</button>
                        {% elif product.status == 'sold' %}
                          <button class="btn-primary" disabled><i class="bi bi-x-circle"></i> Sold Out</button>
                        {% else %}
                          <button class="btn-primary" disabled><i class="bi bi-x-circle"></i> Not Available</button>
                        {% endif %}
                      </div>
                    {% endif %}
                  </div>
                </div>
              </div>
            {% endfor %}
          </div>
        {% else %}
          <div class="empty-state">
            <div class="empty-icon"><i class="bi bi-inbox"></i></div>
            <h3>No products in this category</h3>
            <p>Check back soon for new arrivals in {{ category.name }}!</p>
          </div>
        {% endif %}
      </div>
    {% endfor %}
  {% else %}
    <div class="empty-state">
      <div class="empty-icon"><i class="bi bi-shop"></i></div>
      <h3>Shop Opening Soon</h3>
      <p>Our collection is being curated. Check back soon for amazing products!</p>
    </div>
  {% endif %}
</div>

<!-- Scroll to Top Button -->
<button class="scroll-to-top" id="scrollToTop" aria-label="Scroll to top">
  <i class="bi bi-arrow-up"></i>
</button>

<script>
  document.addEventListener('DOMContentLoaded', () => {
    // Initialize
    updateStats();
    initFilters();
    initSearch();
    initViewToggle();
    initSort();
    initScrollToTop();
    loadWishlist();

    // Show/hide scroll button
    window.addEventListener('scroll', () => {
      document.getElementById('scrollToTop').classList.toggle('visible', window.scrollY > 300);
    });
  });

  function updateStats() {
    const totalProducts = document.querySelectorAll('.product-card').length;
    const availableProducts = document.querySelectorAll('.product-card[data-status="available"]').length;
    const categories = document.querySelectorAll('.category-section').length;

    animateNumber('totalProducts', totalProducts);
    animateNumber('availableProducts', availableProducts);
    animateNumber('totalCategories', categories);
  }

  function animateNumber(id, target) {
    const el = document.getElementById(id);
    let current = 0;
    const duration = 50; // steps
    const step = target / duration;
    let count = 0;
    const timer = setInterval(() => {
      count++;
      current += step;
      if (count >= duration) {
        el.textContent = target;
        clearInterval(timer);
      } else {
        el.textContent = Math.floor(current);
      }
    }, 20);
  }

  const activeFilters = { status: 'all', type: 'all' };

  function initFilters() {
    document.querySelectorAll('.filter-chip').forEach(chip => {
      chip.addEventListener('click', () => {
        const filterType = chip.dataset.filter;
        const filterValue = chip.dataset.value;

        document.querySelectorAll(`[data-filter="${filterType}"]`).forEach(c => c.classList.remove('active'));
        chip.classList.add('active');

        activeFilters[filterType] = filterValue;
        applyFilters();
      });
    });
  }

  function applyFilters() {
    const searchTerm = document.getElementById('searchInput').value.toLowerCase();

    document.querySelectorAll('.product-card').forEach(card => {
      const status = card.dataset.status;
      const type = card.dataset.type;
      const name = card.dataset.name;
      const code = card.dataset.code;
      const sku = card.dataset.sku;

      const statusMatch = (activeFilters.status === 'all') || (status === activeFilters.status);
      const typeMatch = (activeFilters.type === 'all') || (type === activeFilters.type);
      const searchMatch = !searchTerm || name.includes(searchTerm) || code.includes(searchTerm) || sku.includes(searchTerm);

      if (statusMatch && typeMatch && searchMatch) {
        card.style.display = 'flex';
        card.style.animation = 'fadeInUp 0.6s ease-out';
      } else {
        card.style.display = 'none';
      }
    });
    updateCategoryVisibility();
  }

  function updateCategoryVisibility() {
    document.querySelectorAll('.category-section').forEach(cat => {
      const visibleProducts = cat.querySelectorAll('.product-card[style*="display: flex"]');
      cat.style.display = visibleProducts.length ? 'block' : 'none';
    });
  }

  function initSearch() {
    const searchInput = document.getElementById('searchInput');
    const clearBtn = document.getElementById('clearSearch');

    searchInput.addEventListener('input', () => {
      clearBtn.classList.toggle('active', searchInput.value.length > 0);
      setTimeout(applyFilters, 300);
    });

    clearBtn.addEventListener('click', () => {
      searchInput.value = '';
      clearBtn.classList.remove('active');
      applyFilters();
      searchInput.focus();
    });
  }

  function initViewToggle() {
    document.querySelectorAll('.view-btn').forEach(btn => {
      btn.addEventListener('click', () => {
        document.querySelectorAll('.view-btn').forEach(b => b.classList.remove('active'));
        btn.classList.add('active');

        const view = btn.dataset.view;
        document.querySelectorAll('.products-grid').forEach(grid => {
          grid.classList.remove('grid-view', 'list-view');
          grid.classList.add(`${view}-view`);
        });
      });
    });
  }

  function initSort() {
    document.getElementById('sortSelect').addEventListener('change', () => {
      const criteria = document.getElementById('sortSelect').value;
      sortProducts(criteria);
    });
  }

  function sortProducts(criteria) {
    const grids = document.querySelectorAll('.products-grid');
    grids.forEach(grid => {
      const productsArray = Array.from(grid.children);
      productsArray.sort((a, b) => {
        switch(criteria) {
          case 'newest':
            return new Date(b.dataset.created) - new Date(a.dataset.created);
          case 'oldest':
            return new Date(a.dataset.created) - new Date(b.dataset.created);
          case 'price-low':
            return parseFloat(a.dataset.price) - parseFloat(b.dataset.price);
          case 'price-high':
            return parseFloat(b.dataset.price) - parseFloat(a.dataset.price);
          case 'name-az':
            return a.dataset.name.localeCompare(b.dataset.name);
          case 'name-za':
            return b.dataset.name.localeCompare(a.dataset.name);
          default:
            return 0;
        }
      });
      grid.innerHTML = '';
      productsArray.forEach(p => grid.appendChild(p));
    });
  }

  function initScrollToTop() {
    const btn = document.getElementById('scrollToTop');
    btn.addEventListener('click', () => {
      window.scrollTo({ top: 0, behavior: 'smooth' });
    });
  }

  // Guest-only functions
  function loadWishlist() {
    // Optional: Load wishlist if needed
  }

  function toggleWishlist(el, productId) {
    el.classList.toggle('active');
    // Optional: handle wishlist logic
  }

  // Function to add product to cart
// Replace the addToCart function in your shop.html with this updated version

function addToCart(el) {
  const productId = el.dataset.productId;
  const productName = el.dataset.productName;
  const productPrice = parseFloat(el.dataset.productPrice);
  const productCode = el.dataset.productCode;
  const productImage = el.dataset.productImage;
  const maxQuantity = parseInt(el.dataset.maxQuantity) || 1;
  const isSingleItem = el.dataset.isSingleItem === 'true';
  let selectedQuantity = 1;

  // Prompt user for quantity if not a single item and max > 1
  if (!isSingleItem && maxQuantity > 1) {
    const qty = prompt(`Enter quantity (Max ${maxQuantity}):`, '1');
    if (qty === null) return; // user cancelled
    
    selectedQuantity = parseInt(qty);
    if (isNaN(selectedQuantity) || selectedQuantity < 1) selectedQuantity = 1;
    if (selectedQuantity > maxQuantity) selectedQuantity = maxQuantity;
  }

  // Get current cart from localStorage
  let cart = JSON.parse(localStorage.getItem('fieldmax_cart') || '[]');

  // Check if product already exists in cart
  const existingItemIndex = cart.findIndex(item => item.id === parseInt(productId));

  if (existingItemIndex > -1) {
    // Update quantity
    const newQuantity = cart[existingItemIndex].quantity + selectedQuantity;
    
    if (newQuantity > maxQuantity) {
      showNotification(`Cannot add more. Maximum quantity (${maxQuantity}) reached.`, 'warning');
      return;
    }
    
    cart[existingItemIndex].quantity = newQuantity;
    cart[existingItemIndex].subtotal = cart[existingItemIndex].price * newQuantity;
  } else {
    // Add new item
    cart.push({
      id: parseInt(productId),
      name: productName,
      price: productPrice,
      code: productCode,
      image: productImage,
      quantity: selectedQuantity,
      subtotal: productPrice * selectedQuantity,
      max_quantity: maxQuantity,
      is_single_item: isSingleItem
    });
  }

  // Save to localStorage
  localStorage.setItem('fieldmax_cart', JSON.stringify(cart));

  // Update cart count in navbar
  updateCartCount();

  // Show success notification
  showNotification(`‚úÖ ${productName} added to cart!`, 'success');

  // Optional: Add visual feedback to button
  el.innerHTML = '<i class="bi bi-check-circle"></i> Added!';
  el.style.background = 'linear-gradient(135deg, #10b981, #059669)';
  
  setTimeout(() => {
    el.innerHTML = '<i class="bi bi-cart-plus"></i> Add to Cart';
    el.style.background = '';
  }, 2000);

  // Trigger custom event for cart update
  window.dispatchEvent(new Event('cartUpdated'));
}

// Update the notification function
function showNotification(message, type = 'success') {
  // Remove any existing notifications
  const existingToast = document.querySelector('.notification-toast');
  if (existingToast) {
    existingToast.remove();
  }

  // Create notification
  const toast = document.createElement('div');
  toast.className = `notification-toast ${type}`;
  
  const iconMap = {
    success: '‚úÖ',
    warning: '‚ö†Ô∏è',
    error: '‚ùå',
    info: '‚ÑπÔ∏è'
  };

  toast.innerHTML = `
    <div class="toast-icon ${type}">
      <i class="bi bi-${type === 'success' ? 'check-circle' : type === 'warning' ? 'exclamation-triangle' : type === 'error' ? 'x-circle' : 'info-circle'}"></i>
    </div>
    <div class="toast-content">
      <div class="toast-title">${type.charAt(0).toUpperCase() + type.slice(1)}</div>
      <div class="toast-message">${message}</div>
    </div>
  `;

  document.body.appendChild(toast);

  // Auto remove after 3 seconds
  setTimeout(() => {
    toast.style.animation = 'slideOutRight 0.4s ease forwards';
    setTimeout(() => toast.remove(), 400);
  }, 3000);
}

// Add slideOutRight animation to your CSS
const style = document.createElement('style');
style.textContent = `
  @keyframes slideOutRight {
    from {
      opacity: 1;
      transform: translateX(0);
    }
    to {
      opacity: 0;
      transform: translateX(100px);
    }
  }
`;
document.head.appendChild(style);

// Helper function to get CSRF token
function getCookie(name) {
  let cookieValue = null;
  if (document.cookie && document.cookie !== '') {
    const cookies = document.cookie.split(';');
    for (let i = 0; i < cookies.length; i++) {
      const cookie = cookies[i].trim();
      if (cookie.substring(0, name.length + 1) === (name + '=')) {
        cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
        break;
      }
    }
  }
  return cookieValue;
}

// Update cart count in navbar (this function is already in base.html but included here for reference)
function updateCartCount() {
  const cart = JSON.parse(localStorage.getItem('fieldmax_cart') || '[]');
  const totalItems = cart.reduce((sum, item) => sum + item.quantity, 0);
  
  const cartBadge = document.getElementById('cartBadge');
  if (cartBadge) {
    cartBadge.textContent = totalItems;
    if (totalItems === 0) {
      cartBadge.classList.add('empty');
    } else {
      cartBadge.classList.remove('empty');
    }
  }
}

// Helper function to get CSRF token (Django)
function getCookie(name) {
  let cookieValue = null;
  if (document.cookie && document.cookie !== '') {
    const cookies = document.cookie.split(';');
    for (let i=0; i<cookies.length; i++) {
      const cookie = cookies[i].trim();
      if (cookie.substring(0, name.length+1) === (name + '=')) {
        cookieValue = decodeURIComponent(cookie.substring(name.length+1));
        break;
      }
    }
  }
  return cookieValue;
}

// Optional: function to show notification
function showNotification(message, type='success') {
  // Implement your notification logic here
  alert(message);
}
</script>
{% endblock %}